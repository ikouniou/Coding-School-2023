@page "/petreport"
@using PetShop.Model;
@using PetShop.Web.Blazor.Shared.PetReport;
@using PetShop.Web.Blazor.Shared.Transaction;
@inject HttpClient httpClient

<h3>Pet Report</h3>

@if (isLoading) {
	<LoadingSpinner Type="LoadingSpinnerType.Border" />
} else {
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Year</th>
            <th>Month</th>
            <th>Animal Type</th>
            <th>Total Sold</th>
        </tr>
    </thead>
    <tbody>
@*        @foreach (var petReport in petReportList) {
            <tr>
                <td>@petReport.Year</td>
                <td>@petReport.Month</td>
                <td>@petReport.AnimalType</td>
                <td>@petReport.TotalSold</td>
            </tr>
        }*@
    </tbody>
</table>
}
@code {
    //List<PetReportListDto> petReportList = new List<PetReportListDto>();
    //private List<TransactionListDto> Transactions = new();
    bool isLoading { get; set; } = true;

    //int year = 2023;
    //int month = 2;
    //int monthNow = DateTime.Now.Month;
    //int yearNow = DateTime.Now.Year;
    //decimal monthIncome;
    //decimal monthExpenses;
    //decimal TotalSold;

    //protected override async Task OnInitializedAsync() {
    //    await LoadItemsFromServer();
    //    for (int i = year; i <= yearNow; i++) {

    //        for (int j = 2; j <= 12; j++) {
    //            if (i == yearNow && j > monthNow) {
    //                break;
    //            }
    //            DateTime date = new DateTime(i, j, 1);
    //            PetReportListDto petReport = new PetReportListDto();
    //            monthIncome = CalculateMonthlyIncome(date);
    //            monthExpenses = CalculateMonthlyExpenses(date);
    //            petReport.UpdateLedger();
    //            petReportList.Add(petReport);
    //        }
    //    }

    //    isLoading = false;
    //}

    //private async Task LoadItemsFromServer() {
    //    Transactions = await httpClient.GetFromJsonAsync<List<TransactionListDto>>("monthlyledger");
    //}

    //private decimal CalculateMonthlyIncome(DateTime date) {
    //    int month = date.Month;
    //    int year = date.Year;
    //    decimal incomeSum = 0;
    //    List<TransactionListDto> transactionsThisMonth = Transactions
    //    .FindAll(c => c.Date.Month == month)
    //    .FindAll(c => c.Date.Year == year).ToList();
    //    foreach (var transaction in transactionsThisMonth) {
    //        incomeSum += transaction.TotalPrice;
    //    }
    //    return incomeSum;
    //}

    //private decimal CalculateMonthlyExpenses(DateTime date) {
    //    int month = date.Month;
    //    int year = date.Year;
    //    decimal petCostSum = 0;
    //    decimal petFoodCostSum = 0;

    //    List<TransactionListDto> transactionsThisMonth2 = Transactions
    //    .FindAll(c => c.Date.Month == month)
    //    .FindAll(c => c.Date.Year == year).ToList();
    //    foreach (var transaction in transactionsThisMonth2) {
    //        foreach (var pet in transaction.Pets) {
    //            petCostSum += pet.Cost;
    //        }
    //        foreach (var petFood in transaction.PetFoods) {
    //            petFoodCostSum += petFood.Cost;
    //        }
    //    }

    //    return petFoodCostSum + petCostSum;
    //}
}