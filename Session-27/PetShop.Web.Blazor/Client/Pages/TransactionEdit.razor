@page "/transactionlist/edit/{Id:int?}"
@using PetShop.Model
@using PetShop.Web.Blazor.Shared.Transaction

@inject HttpClient httpClient
@inject NavigationManager navigationManager

<h3>Transaction Edit</h3>

@if (Transaction == null) {
	<p>Loading...</p>
} else {
	<div class="row">
		<div class="col-md-6">
			<label class="form-label">Date</label>
			<input class="form-control" @bind="@Transaction.Date" />
		</div>
	</div>

	<div class="row">
		<div class="col-md-6">
			<label class="form-label">Pet Price</label>
			<input class="form-control" @bind="@Transaction.PetPrice" />
		</div>
	</div>

	<div class="row">
		<div class="col-md-6">
			<label class="form-label">Pet Food Qty</label>
			<input class="form-control" @bind="@Transaction.PetFoodQty" />
		</div>
	</div>

	<div class="row">
		<div class="col-md-6">
			<label class="form-label">Pet Food Price</label>
			<input class="form-control" @bind="@Transaction.PetFoodPrice" />
		</div>
	</div>

	<div class="row">
		<div class="col-md-6">
			<label class="form-label">Total Cost</label>
			<input class="form-control" @bind="@Transaction.TotalPrice" />
		</div>
	</div>

	<div class="row mt-2">
		<div class="col">
			<button class="btn btn-success" @onclick="OnSave">Save</button>
			<button class="btn btn-danger" @onclick="OnCancel">Cancel</button>
		</div>
	</div>
}

@code {
	[Parameter] public int? Id { get; set; }
	TransactionEditDto Transaction { get; set; }

	protected override async Task OnInitializedAsync() {
		if (Id == null) {
			Transaction = new();
		} else {
			Transaction = await httpClient.GetFromJsonAsync<TransactionEditDto>($"transaction/{Id}");
		}
	}
	private void OnCancel() {
		navigationManager.NavigateTo("transactionlist");
	}
	private async Task OnSave() {
		HttpResponseMessage? response = null;
		if (Id == null) {
			response = await httpClient.PostAsJsonAsync("transaction", Transaction);
		} else {
			response = await httpClient.PutAsJsonAsync("transaction", Transaction);
		}
		response.EnsureSuccessStatusCode();
		navigationManager.NavigateTo("transactionlist");
	}
}